# 📚 自动交易脚本 - 新手完全使用手册

## 🌟 欢迎使用自动交易脚本！

这是一个零基础的完整使用手册，即使您完全没有编程经验，也能轻松上手使用这个自动交易脚本。

---

## 📖 目录

1. [什么是自动交易脚本](#什么是自动交易脚本)
2. [准备工作](#准备工作)
3. [安装教程](#安装教程)
4. [配置详解](#配置详解)
5. [使用方法](#使用方法)
6. [功能详解](#功能详解)
7. [常见问题](#常见问题)
8. [故障排除](#故障排除)
9. [安全须知](#安全须知)

---

## 🤖 什么是自动交易脚本

### 简单解释
想象一下，您每天都要在固定时间（比如下午3:50）买入1股QQQ（一种股票），但您可能会忘记，或者当时在忙其他事情。

这个脚本就像一个**机器人助手**，它会：
- 24小时不间断地监控时间
- 在指定时间自动帮您买入股票
- 只在股市开放的交易日执行
- 详细记录每一次操作
- 出现问题时及时提醒您

### 核心功能
✅ **定时买入**: 每个交易日的固定时间自动买入  
✅ **智能判断**: 自动识别交易日，节假日不操作  
✅ **安全可靠**: 使用模拟账户测试，确保资金安全  
✅ **详细记录**: 完整的操作日志，方便您查看  
✅ **灵活配置**: 可以修改股票代码、数量、时间等  

---

## 🛠️ 准备工作

### 1. 您需要准备的东西

#### 必需品：
- **电脑**: Windows、Mac或Linux都可以
- **网络连接**: 稳定的互联网连接
- **Alpaca账户**: 免费的股票交易账户

#### 可选品：
- **基本的电脑操作知识**: 会复制粘贴、打开文件夹即可
- **15-30分钟的时间**: 用于初始设置

### 2. 什么是Alpaca？

**Alpaca** 是一个专业的股票交易平台，提供：
- 🆓 **免费账户**
- 🎮 **模拟交易**: 用虚拟资金练习，不会损失真钱
- 🔒 **安全可靠**: 受美国金融监管
- 📱 **API接口**: 允许程序自动交易

**重要**: 我们默认使用**模拟交易**，不会动用您的真实资金！

---

## 📥 安装教程

### 第一步：创建Alpaca账户

1. **访问官网**: 打开 [https://alpaca.markets/](https://alpaca.markets/)
2. **点击注册**: 找到"Sign Up"按钮
3. **填写信息**: 
   - 邮箱地址
   - 设置密码
   - 基本个人信息
4. **验证邮箱**: 检查邮件并点击验证链接
5. **获取API密钥**:
   - 登录后进入"API Keys"页面
   - 点击"Generate New Key"
   - **重要**: 保存好这两个密钥，稍后会用到
     - `API Key ID`: 类似用户名
     - `Secret Key`: 类似密码

### 第二步：安装Python

#### Windows用户：
1. 访问 [https://www.python.org/downloads/](https://www.python.org/downloads/)
2. 下载Python 3.8以上版本
3. 运行安装程序
4. **重要**: 勾选"Add Python to PATH"
5. 点击"Install Now"

#### Mac用户：
```bash
# 如果已安装Homebrew
brew install python3

# 或者从官网下载安装包
# https://www.python.org/downloads/mac-osx/
```

#### 验证安装：
打开命令行输入：
```bash
python --version
```
应该显示类似：`Python 3.8.x`

### 第三步：下载项目

#### 方法1：使用Git（推荐）
```bash
git clone https://github.com/yourusername/auto-trader.git
cd auto-trader
```

#### 方法2：直接下载
1. 访问项目GitHub页面
2. 点击绿色"Code"按钮
3. 选择"Download ZIP"
4. 解压到您喜欢的文件夹

### 第四步：安装依赖

1. **打开命令行**，进入项目文件夹
2. **创建虚拟环境**（推荐）：
   ```bash
   python -m venv venv
   ```
3. **激活虚拟环境**：
   ```bash
   # Windows
   venv\Scripts\activate
   
   # Mac/Linux
   source venv/bin/activate
   ```
4. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

---

## ⚙️ 配置详解

### 创建配置文件

1. **复制模板文件**：
   ```bash
   cp env.example .env
   ```
   
2. **编辑配置文件**：
   用记事本或任何文本编辑器打开 `.env` 文件

### 配置参数详解

```env
# ===== Alpaca API配置 =====
APCA_API_KEY_ID=your_api_key_here
APCA_API_SECRET_KEY=your_secret_key_here
APCA_BASE_URL=https://paper-api.alpaca.markets

# ===== 交易设置 =====
TRADING_SYMBOL=QQQ
TRADING_QUANTITY=1
TRIGGER_TIME=15:50
```

#### 📝 参数说明

| 参数名 | 说明 | 示例 | 必填？ |
|--------|------|------|--------|
| `APCA_API_KEY_ID` | 您的API密钥ID | PK7NH... | ✅ 必填 |
| `APCA_API_SECRET_KEY` | 您的API密钥Secret | iX47V... | ✅ 必填 |
| `APCA_BASE_URL` | 交易环境URL | 见下表 | ❌ 可选 |
| `TRADING_SYMBOL` | 要买入的股票代码 | QQQ, AAPL, TSLA | ❌ 可选 |
| `TRADING_QUANTITY` | 买入数量 | 1, 5, 10 | ❌ 可选 |
| `TRIGGER_TIME` | 触发时间 | 15:50, 09:30 | ❌ 可选 |

#### 🌐 交易环境选择

| 环境 | URL | 说明 |
|------|-----|------|
| **模拟交易** | `https://paper-api.alpaca.markets` | 用虚拟资金，安全练习 |
| **真实交易** | `https://api.alpaca.markets` | 用真实资金，有风险 |

**新手建议**: 先使用模拟交易熟悉流程！

#### 🎯 股票代码说明

| 代码 | 全名 | 说明 |
|------|------|------|
| `QQQ` | Invesco QQQ Trust | 追踪纳斯达克100指数的ETF |
| `SPY` | SPDR S&P 500 ETF | 追踪标普500指数的ETF |
| `AAPL` | Apple Inc. | 苹果公司股票 |
| `GOOGL` | Alphabet Inc. | 谷歌公司股票 |

#### ⏰ 时间设置说明

- **格式**: `HH:MM`（24小时制）
- **时区**: 美国东部时间（EST/EDT）
- **交易时间**: 09:30-16:00（美东时间）
- **建议时间**: 
  - `09:30`: 开盘时买入
  - `15:50`: 收盘前买入（默认）
  - `12:00`: 中午买入

---

## 🚀 使用方法

### 快速开始

#### 1. 测试连接
```bash
python test_connection.py
```
**期望输出**:
```
🔍 正在加载配置...
✅ 配置加载成功
🔗 正在连接 Alpaca API...
✅ API 连接成功!
   账户状态: ACTIVE
   交易模式: 模拟交易
   账户余额: $100000.00
```

#### 2. 运行一次检查
```bash
python auto_trader.py --once
```
**用途**: 测试当前是否会触发交易

#### 3. 持续运行
```bash
python auto_trader.py
```
**用途**: 脚本会持续运行，等待触发时间

### 使用启动脚本（推荐）

#### Windows用户
双击 `run.bat` 文件，或在命令行输入：
```cmd
run.bat
```

#### Mac/Linux用户
```bash
./run.sh
```

### 命令行参数详解

```bash
python auto_trader.py [参数]
```

| 参数 | 说明 | 示例 |
|------|------|------|
| `--once` | 只运行一次检查 | `python auto_trader.py --once` |
| `--interval 秒数` | 设置检查间隔 | `python auto_trader.py --interval 30` |
| `--config 文件路径` | 使用自定义配置文件 | `python auto_trader.py --config my.env` |

### 实际使用场景

#### 场景1：每日定投QQQ
```bash
# 配置文件设置
TRADING_SYMBOL=QQQ
TRADING_QUANTITY=1
TRIGGER_TIME=15:50

# 运行命令
python auto_trader.py
```

#### 场景2：开盘买入苹果股票
```bash
# 配置文件设置
TRADING_SYMBOL=AAPL
TRADING_QUANTITY=5
TRIGGER_TIME=09:30

# 运行命令
python auto_trader.py
```

#### 场景3：测试模式
```bash
# 只运行一次，看看会不会触发
python auto_trader.py --once

# 快速检查（每10秒检查一次）
python auto_trader.py --interval 10
```

---

## 🔧 功能详解

### 1. 自动交易核心功能

#### 工作流程图
```
开始 → 加载配置 → 连接API → 检查当前时间 → 
是否交易日？ → 是否到达触发时间？ → 提交买单 → 
记录日志 → 等待下次检查 → 循环
```

#### 详细说明

1. **时间监控**: 
   - 每分钟检查一次当前时间
   - 与设定的触发时间比较
   - 使用美国东部时间

2. **交易日判断**:
   - 自动获取股市日历
   - 跳过周末和节假日
   - 只在交易日执行操作

3. **下单逻辑**:
   - 市价单（Market Order）
   - 立即执行
   - GTC（Good Till Cancelled）有效期

4. **防重复机制**:
   - 成功下单后等待61秒
   - 避免同一分钟重复下单

### 2. 日志系统

#### 日志位置
- **控制台**: 实时显示状态
- **文件**: `auto_trader.log`

#### 日志级别
- **INFO**: 正常操作信息
- **ERROR**: 错误信息
- **DEBUG**: 调试信息（详细）

#### 日志内容示例
```
2025-07-10 13:35:03 - INFO - 🕒 2025-07-10 13:35:03 是交易日，触发下单
2025-07-10 13:35:03 - INFO - ⏳ 准备提交 QQQ 买单...
2025-07-10 13:35:03 - INFO - ✅ 已提交 1 股 QQQ 市价买单
2025-07-10 13:35:03 - INFO - 订单ID: 1b9879fc-c916-4e91-83b7-351c8b9f0a7b
```

### 3. 配置管理

#### 配置验证
- 启动时检查所有必需参数
- 验证API密钥格式
- 检查时间格式
- 确认交易数量大于0

#### 配置热更新
- 修改 `.env` 文件后重启脚本即可生效
- 不需要重新安装

### 4. 错误处理

#### 网络错误
- 自动重试机制
- 连接超时处理
- 网络中断恢复

#### API错误
- 账户余额不足
- 股票代码无效
- 市场关闭时间

#### 系统错误
- 文件权限问题
- 内存不足
- 系统时间错误

---

## ❓ 常见问题

### Q1: 脚本会24小时运行吗？
**A**: 是的，脚本会持续运行并监控时间。但您可以：
- 使用 `--once` 参数只运行一次
- 按 `Ctrl+C` 随时停止
- 设置系统定时任务在特定时间启动

### Q2: 会不会亏钱？
**A**: 默认使用模拟交易，不会使用真实资金。如果您改为真实交易，投资有风险，请谨慎操作。

### Q3: 可以同时买多只股票吗？
**A**: 当前版本只支持一只股票。如需多只股票，请：
- 创建多个配置文件
- 同时运行多个脚本实例

### Q4: 如何修改买入时间？
**A**: 编辑 `.env` 文件中的 `TRIGGER_TIME` 参数，格式为 `HH:MM`。

### Q5: 脚本会自动更新吗？
**A**: 不会自动更新，需要手动从GitHub拉取最新代码。

### Q6: 支持卖出操作吗？
**A**: 当前版本只支持买入，卖出功能可能在后续版本中添加。

### Q7: 可以设置多个买入时间吗？
**A**: 当前版本只支持一个时间点。如需多个时间，请运行多个脚本实例。

### Q8: 账户余额不足怎么办？
**A**: 脚本会记录错误信息，您需要：
- 检查账户余额
- 减少买入数量
- 或者充值账户

---

## 🔧 故障排除

### 常见错误及解决方案

#### 错误1: `ModuleNotFoundError`
**问题**: 缺少Python模块
**解决**: 
```bash
pip install -r requirements.txt
```

#### 错误2: `API连接失败`
**问题**: 网络或API密钥问题
**解决**: 
1. 检查网络连接
2. 确认API密钥正确
3. 检查Alpaca服务状态

#### 错误3: `配置文件未找到`
**问题**: `.env` 文件不存在
**解决**: 
```bash
cp env.example .env
# 然后编辑 .env 文件
```

#### 错误4: `权限被拒绝`
**问题**: 文件权限问题
**解决**: 
```bash
chmod +x run.sh  # Linux/Mac
```

#### 错误5: `时间格式错误`
**问题**: `TRIGGER_TIME` 格式不正确
**解决**: 使用24小时制格式，如 `15:50`

### 调试技巧

#### 1. 启用详细日志
```bash
export LOG_LEVEL=DEBUG
python auto_trader.py --once
```

#### 2. 检查配置
```bash
python test_connection.py
```

#### 3. 查看日志文件
```bash
tail -f auto_trader.log
```

#### 4. 测试网络连接
```bash
ping api.alpaca.markets
```

---

## 🛡️ 安全须知

### 重要安全提醒

#### 1. API密钥安全
- 🔒 **不要分享**: 永远不要将API密钥告诉他人
- 📝 **不要上传**: 不要将 `.env` 文件上传到GitHub
- 🔄 **定期更换**: 建议每3个月更换一次密钥
- 💾 **安全存储**: 将密钥保存在安全的地方

#### 2. 资金安全
- 🎮 **先模拟**: 新手必须先使用模拟交易
- 💰 **小额测试**: 真实交易时先用小额资金测试
- 📊 **监控账户**: 定期检查交易记录和账户余额
- 🚨 **设置限额**: 在Alpaca账户中设置每日交易限额

#### 3. 系统安全
- 🔐 **系统更新**: 保持操作系统和Python更新
- 🛡️ **防火墙**: 启用系统防火墙
- 💻 **安全扫描**: 定期进行病毒扫描

### 风险提示

#### 投资风险
- 📈 **市场风险**: 股价可能上涨或下跌
- 💸 **本金风险**: 可能损失投资本金
- 🕰️ **时间风险**: 长期投资需要耐心

#### 技术风险
- 🌐 **网络风险**: 网络中断可能影响交易
- 🖥️ **系统风险**: 电脑故障可能导致交易失败
- 🔧 **软件风险**: 程序bug可能导致意外行为

#### 法律风险
- 📋 **合规要求**: 确保遵守当地法律法规
- 🏛️ **税务责任**: 交易盈利需要缴纳税款
- 📄 **监管变化**: 金融监管政策可能变化

---

## 📞 获取帮助

### 联系方式

#### GitHub Issues
- **问题报告**: [https://github.com/yourusername/auto-trader/issues](https://github.com/yourusername/auto-trader/issues)
- **功能请求**: 在Issues中提出新功能建议
- **Bug报告**: 详细描述问题和重现步骤

#### 社区支持
- **讨论区**: GitHub Discussions
- **文档**: 项目Wiki页面
- **更新**: 关注项目Release页面

### 提问技巧

#### 有效的问题描述
1. **环境信息**: 操作系统、Python版本
2. **具体步骤**: 详细描述操作过程
3. **错误信息**: 完整的错误日志
4. **预期结果**: 您期望的正确行为
5. **实际结果**: 实际发生的情况

#### 问题模板
```
**环境信息**:
- 操作系统: Windows 10
- Python版本: 3.9.7
- 项目版本: 1.0.0

**问题描述**:
[详细描述问题]

**重现步骤**:
1. 执行命令: python auto_trader.py
2. 等待5分钟
3. 出现错误

**错误信息**:
[粘贴完整错误日志]

**配置信息**:
[删除敏感信息后的配置]
```

---

## 🎯 下一步计划

看完这个手册，您应该能够：

1. ✅ 理解自动交易的基本概念
2. ✅ 成功安装和配置脚本
3. ✅ 独立运行和管理脚本
4. ✅ 处理常见问题和错误
5. ✅ 安全地使用自动交易功能

### 建议的学习路径

#### 第1周：基础设置
- [ ] 创建Alpaca账户
- [ ] 安装Python和项目依赖
- [ ] 配置环境变量
- [ ] 运行模拟交易测试

#### 第2周：功能熟悉
- [ ] 尝试不同的配置参数
- [ ] 理解日志系统
- [ ] 练习故障排除
- [ ] 阅读交易记录

#### 第3周：进阶使用
- [ ] 尝试不同的股票代码
- [ ] 调整交易时间
- [ ] 优化配置参数
- [ ] 学习市场基础知识

#### 第4周：自主管理
- [ ] 独立解决问题
- [ ] 优化投资策略
- [ ] 考虑实盘交易（谨慎）
- [ ] 分享使用经验

---

## 💡 温馨提示

### 成功使用的秘诀

1. **从小开始**: 先用模拟交易熟悉流程
2. **持续学习**: 了解股票市场基础知识
3. **定期检查**: 每天查看交易记录和账户状态
4. **保持耐心**: 投资是长期行为，不要急于求成
5. **风险控制**: 永远不要投入无法承受损失的资金

### 联系我们

如果这个手册对您有帮助，欢迎：
- ⭐ 给项目点个Star
- 🔄 分享给朋友
- 💬 提供改进建议
- 🐛 报告问题

**祝您投资顺利！** 🚀

---

*最后更新: 2025年7月10日*  
*版本: 1.0.0* 